# Feature Specification: HTML5 Mario Clone with Logos

**Feature Branch**: `001-canvas-mario-clone`  
**Created**: 2026-02-26  
**Status**: Draft  
**Input**: User description: "帮我复刻一个基于 HTML5 Canvas 和 JavaScript 的《超级马里奥》网页游戏。 核心机制包括：1. 2D横向卷轴与相机跟随； 2. 基础物理（重力、跳跃、加速度）； 3. AABB 矩形碰撞检测（包含与砖块的碰撞）； 4. 基础实体（马里奥、板栗仔 Goomba、金币、可顶碎的砖块）。 5. 加入历史上有名公司的一些LOGO，比如特斯拉、google、大众、可口可乐等。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 完成基础通关 (Priority: P1)
玩家在浏览器中控制马里奥横向跑跳，通过相机跟随浏览完整关卡并在限定时间内抵达终点旗帜。

**Why this priority**: 这是核心玩法，验证移动、跳跃、相机跟随和关卡滚动的完整体验。

**Independent Test**: 启动游戏→控制马里奥向右移动和跳跃→相机跟随不抖动→到达终点触发通关状态。

**Acceptance Scenarios**:

1. **Given** 游戏开始在起点，**When** 玩家按住移动键，**Then** 马里奥移动且相机平滑跟随，不越界显示。
2. **Given** 玩家在平台边缘，**When** 按跳跃键，**Then** 马里奥起跳并落地，未穿透地面且未延迟超过100ms。

---

### User Story 2 - 收集与砖块互动 (Priority: P2)
玩家在关卡中收集金币、顶碎砖块，实时看到计分/计数反馈。

**Why this priority**: 收集与破坏反馈是马里奥体验的关键动力，影响得分与探索。

**Independent Test**: 进入含金币与砖块的区段→收集金币→顶砖块→分数/计数即时更新并持久到关卡结束。

**Acceptance Scenarios**:

1. **Given** 马里奥触碰金币，**When** 碰撞完成，**Then** 金币消失且计分/金币数立刻增加。
2. **Given** 马里奥从下方顶到砖块，**When** 砖块被破坏，**Then** 砖块碎裂动画结束后该砖块不可再碰撞。

---

### User Story 3 - 敌人与品牌展示 (Priority: P3)
玩家与板栗仔（Goomba）交互：踩灭可得分，侧面碰撞会受伤；同时关卡背景或看板展示知名品牌LOGO，不影响玩法。

**Why this priority**: 敌人交互确保基础战斗体验；品牌展示满足定制化视觉诉求且不能干扰操作。

**Independent Test**: 进入含Goomba与品牌看板的区段→踩灭/碰撞敌人触发对应结果→LOGO清晰可见但不遮挡视线。

**Acceptance Scenarios**:

1. **Given** 马里奥从上方落到Goomba，**When** 接触发生，**Then** Goomba被消灭、分数增加，马里奥保持存活并反弹。
2. **Given** 马里奥侧面撞到Goomba，**When** 接触发生，**Then** 马里奥进入受伤/失败状态，Goomba继续存在。
3. **Given** 品牌LOGO看板在场景中，**When** 玩家经过，**Then** LOGO清晰显示且不遮挡角色或重要路径。

### Edge Cases
- 同一帧内同时发生顶砖和踩敌人时，优先保证砖块破坏与敌人消灭均被记录且无重复计分。
- 马里奥处于相机边界时，快速反向移动不会出现抖动或画面撕裂。
- 连续收集多个紧邻金币时，计数无丢失或重复；金币刷新后不可再次碰撞。
- 掉落到场景底部或超出关卡范围时立即判定失败并重置。
- LOGO资源缺失或加载失败时，回退为占位图且不阻塞关卡流程。

## Requirements *(mandatory)*

### Functional Requirements
- **FR-001**: 提供横向卷轴关卡，支持平滑相机跟随并限制视野在关卡范围内。
- **FR-002**: 角色运动包含重力、加速度与跳跃高度控制，体验在60fps下流畅且输入响应不超过100ms。
- **FR-003**: 采用轴对齐矩形碰撞，按X轴先于Y轴的顺序检测与分离，防止卡角和穿透。
- **FR-004**: 马里奥可从下方顶碎可破坏砖块；破坏后砖块移除并更新计分。
- **FR-005**: 金币可被收集，收集后从场景移除并实时更新可见的金币/得分计数。
- **FR-006**: 敌人Goomba具备巡逻/行进轨迹；从上方踩击消灭并得分，侧面或被撞到玩家则判定受伤/失败。
- **FR-007**: LOGO以非交互式看板/背景形式呈现，不遮挡关键路径或UI；缺失时使用通用占位图。
- **FR-008**: 关卡失败（受伤或坠落）与通关均应有明确状态与可重开入口。
- **FR-009**: 游戏内的计分、金币、生命等状态在单次会话中保持一致且可重置；重复播放时行为可重现。
- **FR-010**: 资源与展示遵守非商业、授权前提：仅使用获得许可的品牌素材或自制风格化替代图形。

### Key Entities *(include if feature involves data)*
- **Player (Mario)**: 位置、速度、状态（行走/跳跃/受伤/胜利），与平台/敌人/物品的碰撞。
- **Enemy (Goomba)**: 位置、移动方向、存活状态，被踩灭/碰撞导致的分值与玩家状态变化。
- **Coin**: 位置、可见性、收集后计分与移除。
- **Brick Block**: 位置、可破坏标记、被顶碎后的移除/碎裂表现。
- **Ground/Tile**: 平台和地面几何，用于碰撞与相机边界。
- **Camera**: 视窗位置、跟随规则、关卡边界约束。
- **Logo Billboard**: 关联品牌标识、展示位置、占位回退资源。
- **Level State**: 计分、金币数、剩余生命、关卡完成/失败标记。

## Success Criteria *(mandatory)*

### Measurable Outcomes
- **SC-001**: 95% 的玩家在首次尝试中可于3分钟内完成基础关卡。
- **SC-002**: 输入到屏幕响应的可见延迟≤100ms，连续移动/跳跃无明显掉帧（玩家主观感受为流畅）。
- **SC-003**: 10 次重复回放中，角色轨迹与碰撞结果一致，计分差异为0。
- **SC-004**: 90% 的受测玩家认为品牌LOGO清晰可见且不影响操作（问卷“未被遮挡/干扰”选“同意”或以上）。
- **SC-005**: 金币与砖块交互的计数准确率达到100%（无遗漏、无重复计分），在20次交互测试中全部通过。
